{% extends "basement/base.html" %}
{% load static %}

{% block style %}
.nav-link-white { color: #16a34a; }
.nav-link-green { color: white; }
.nav-link-blue { color: deepskyblue; }
.logo-link { color: #16a34a; }

.donation-banner {
    animation: slideDown 0.5s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.pulse-ring {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}
{% endblock style %}

{% block content %}
<!-- Donation Success Banner (shown if user just donated) -->   
{% if show_donation_prompt %}
<div class="donation-banner bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <div class="flex items-center justify-center gap-3">
            <div class="pulse-ring">üéâ</div>
            <p class="text-lg font-semibold">
                {% if language == 'ru' %}
                    –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ! –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤–∞—à –≤–∫–ª–∞–¥
                {% elif language == 'kz' %}
                    “ö–∞–π—ã—Ä—ã–º–¥—ã–ª—ã“õ “Ø—à—ñ–Ω —Ä–∞—Ö–º–µ—Ç! –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∞–ª—É –∂”ô–Ω–µ “Ø–ª–µ—Å—ñ“£—ñ–∑–¥—ñ “õ–∞–¥–∞“ì–∞–ª–∞—É “Ø—à—ñ–Ω —Ç—ñ—Ä–∫–µ–ª—ñ“£—ñ–∑
                {% else %}
                    Thank you for your donation! Register to receive your certificate and track your impact
                {% endif %}
            </p>
        </div>
    </div>
</div>
{% endif %}

<section class="min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 flex items-center justify-center py-20 px-4">
    <div class="max-w-md w-full">
        <!-- Registration Card -->
        <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-10">
            <div class="text-center mb-8">
                <div class="inline-block bg-gradient-to-br from-green-500 to-emerald-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-3xl mb-4">
                    üå±
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-2">
                    {% if language == 'ru' %}–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç{% elif language == 'kz' %}–ê–∫–∫–∞—É–Ω—Ç –∂–∞—Å–∞—É{% else %}Create Account{% endif %}
                </h2>
                <p class="text-gray-600">
                    {% if language == 'ru' %}–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –¥–≤–∏–∂–µ–Ω–∏—é –∑–∞ –∑–µ–ª–µ–Ω–æ–µ –±—É–¥—É—â–µ–µ{% elif language == 'kz' %}–ñ–∞—Å—ã–ª –±–æ–ª–∞—à–∞“õ “õ–æ–∑“ì–∞–ª—ã—Å—ã–Ω–∞ “õ–æ—Å—ã–ª—ã“£—ã–∑{% else %}Join the movement for a greener future{% endif %}
                </p>
            </div>

            <!-- Registration Form -->
            <form id="register-form" method="POST" action="{% url 'main_app:register' %}" class="space-y-5">
                {% csrf_token %}
                
                <!-- Name Input -->
                <div>
                    <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                        {% if language == 'ru' %}–ü–æ–ª–Ω–æ–µ –∏–º—è{% elif language == 'kz' %}–¢–æ–ª—ã“õ –∞—Ç—ã{% else %}Full Name{% endif %}
                    </label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        required 
                        minlength="2"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none transition-colors"
                        placeholder="{% if language == 'ru' %}–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤{% elif language == 'kz' %}–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤{% else %}John Doe{% endif %}"
                    >
                </div>

                <!-- Email Input -->
                <div>
                    <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                        Email
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none transition-colors"
                        placeholder="{% if language == 'ru' %}ivan@example.com{% elif language == 'kz' %}ivan@example.com{% else %}john@example.com{% endif %}"
                    >
                </div>

                <!-- Password Input -->
                <div>
                    <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">
                        {% if language == 'ru' %}–ü–∞—Ä–æ–ª—å{% elif language == 'kz' %}“ö“±–ø–∏—è —Å”©–∑{% else %}Password{% endif %}
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        minlength="8"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none transition-colors"
                        placeholder="{% if language == 'ru' %}–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤{% elif language == 'kz' %}–ö–µ–º—ñ–Ω–¥–µ 8 —Ç–∞“£–±–∞{% else %}Minimum 8 characters{% endif %}"
                    >
                    <p class="mt-1 text-xs text-gray-500">
                        {% if language == 'ru' %}–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤{% elif language == 'kz' %}–ö–µ–º—ñ–Ω–¥–µ 8 —Ç–∞“£–±–∞ –ø–∞–π–¥–∞–ª–∞–Ω—ã“£—ã–∑{% else %}Use at least 8 characters{% endif %}
                    </p>
                </div>

                <!-- Confirm Password Input -->
                <div>
                    <label for="password_confirm" class="block text-sm font-semibold text-gray-700 mb-2">
                        {% if language == 'ru' %}–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å{% elif language == 'kz' %}“ö“±–ø–∏—è —Å”©–∑–¥—ñ —Ä–∞—Å—Ç–∞“£—ã–∑{% else %}Confirm Password{% endif %}
                    </label>
                    <input 
                        type="password" 
                        id="password_confirm" 
                        name="password_confirm" 
                        required 
                        minlength="8"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none transition-colors"
                        placeholder="{% if language == 'ru' %}–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å{% elif language == 'kz' %}“ö“±–ø–∏—è —Å”©–∑–¥—ñ “õ–∞–π—Ç–∞–ª–∞“£—ã–∑{% else %}Repeat password{% endif %}"
                    >
                </div>

                <!-- Error Message -->
                <div id="error-message" class="hidden bg-red-50 border-2 border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm"></div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submit-btn"
                    class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-4 rounded-xl transition-all transform hover:scale-[1.02] shadow-lg"
                >
                    <span id="submit-text">
                        {% if language == 'ru' %}–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è{% elif language == 'kz' %}–¢—ñ—Ä–∫–µ–ª—É{% else %}Register{% endif %}
                    </span>
                    <span id="submit-loader" class="hidden">
                        ‚è≥ {% if language == 'ru' %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...{% elif language == 'kz' %}–¢—ñ—Ä–∫–µ—É...{% else %}Registering...{% endif %}
                    </span>
                </button>

                <!-- Login Link -->
                <p class="text-center text-gray-600 text-sm mt-4">
                    {% if language == 'ru' %}–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?{% elif language == 'kz' %}–ê–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑ –±–∞—Ä –º–∞?{% else %}Already have an account?{% endif %}
                    <a href="{% url 'main_app:login' %}" class="text-green-600 hover:text-green-700 font-semibold">
                        {% if language == 'ru' %}–í–æ–π—Ç–∏{% elif language == 'kz' %}–ö—ñ—Ä—É{% else %}Login{% endif %}
                    </a>
                </p>
            </form>
        </div>

        <!-- Benefits Section -->
        {% if has_pending_order %}
        <div class="mt-8 bg-white rounded-2xl p-6 shadow-lg">
            <h3 class="font-bold text-lg text-gray-800 mb-4 text-center">
                {% if language == 'ru' %}–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:{% elif language == 'kz' %}–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω–Ω–µ–Ω –∫–µ–π—ñ–Ω —Å—ñ–∑ –∞–ª–∞—Å—ã–∑:{% else %}After registration you'll get:{% endif %}
            </h3>
            <ul class="space-y-3">
                <li class="flex items-center gap-3 text-gray-700">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">üìú</div>
                    <span>{% if language == 'ru' %}–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ—Å–∞–¥–∫–∏ –¥–µ—Ä–µ–≤—å–µ–≤{% elif language == 'kz' %}–ñ–µ–∫–µ –∞“ì–∞—à –æ—Ç—ã—Ä“ì—ã–∑—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã{% else %}Personal tree planting certificate{% endif %}</span>
                </li>
                <li class="flex items-center gap-3 text-gray-700">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">üìç</div>
                    <span>{% if language == 'ru' %}GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ —Ñ–æ—Ç–æ –≤–∞—à–∏—Ö –¥–µ—Ä–µ–≤—å–µ–≤{% elif language == 'kz' %}GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—Ç–∞—Ä –∂”ô–Ω–µ –∞“ì–∞—à—Ç–∞—Ä–¥—ã“£ —Ñ–æ—Ç–æ—Å—ã{% else %}GPS coordinates and photos of your trees{% endif %}</span>
                </li>
                <li class="flex items-center gap-3 text-gray-700">
                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">üìä</div>
                    <span>{% if language == 'ru' %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞—à–µ–≥–æ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –≤–∫–ª–∞–¥–∞{% elif language == 'kz' %}–≠–∫–æ–ª–æ–≥–∏—è–ª—ã“õ “Ø–ª–µ—Å—ñ“£—ñ–∑–¥—ñ“£ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã{% else %}Statistics of your environmental impact{% endif %}</span>
                </li>
                <li class="flex items-center gap-3 text-gray-700">
                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">üèÜ</div>
                    <span>{% if language == 'ru' %}–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –Ω–∞–≥—Ä–∞–¥—ã{% elif language == 'kz' %}–ñ–µ—Ç—ñ—Å—Ç—ñ–∫—Ç–µ—Ä –º–µ–Ω —Å—ã–π–ª—ã“õ—Ç–∞—Ä{% else %}Achievements and rewards{% endif %}</span>
                </li>
            </ul>
        </div>
        {% endif %}
    </div>
</section>

<script>
document.getElementById('register-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const submitLoader = document.getElementById('submit-loader');
    const errorMessage = document.getElementById('error-message');
    
    // Disable button
    submitBtn.disabled = true;
    submitText.classList.add('hidden');
    submitLoader.classList.remove('hidden');
    errorMessage.classList.add('hidden');
    
    const formData = new FormData(this);
    
    try {
        const response = await fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Show success message
            errorMessage.classList.remove('hidden', 'bg-red-50', 'border-red-200', 'text-red-700');
            errorMessage.classList.add('bg-green-50', 'border-green-200', 'text-green-700');
            errorMessage.textContent = data.message;
            
            // Redirect after short delay
            setTimeout(() => {
                window.location.href = data.redirectUrl || '/profile/';
            }, 1500);
        } else {
            // Show error
            errorMessage.classList.remove('hidden');
            errorMessage.textContent = data.message;
            
            // Re-enable button
            submitBtn.disabled = false;
            submitText.classList.remove('hidden');
            submitLoader.classList.add('hidden');
        }
    } catch (error) {
        console.error('Registration error:', error);
        errorMessage.classList.remove('hidden');
        errorMessage.textContent = '{% if language == "ru" %}–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.{% elif language == "kz" %}–°–µ—Ä–≤–µ—Ä “õ–∞—Ç–µ—Å—ñ. –ö–µ–π—ñ–Ω—ñ—Ä–µ–∫ –∫”©—Ä—ñ“£—ñ–∑.{% else %}Server error. Please try again later.{% endif %}';
        
        // Re-enable button
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        submitLoader.classList.add('hidden');
    }
});

// Password confirmation validation
document.getElementById('password_confirm').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const confirmPassword = this.value;
    
    if (confirmPassword && password !== confirmPassword) {
        this.setCustomValidity('{% if language == "ru" %}–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç{% elif language == "kz" %}“ö“±–ø–∏—è —Å”©–∑–¥–µ—Ä —Å”ô–π–∫–µ—Å –∫–µ–ª–º–µ–π–¥—ñ{% else %}Passwords do not match{% endif %}');
    } else {
        this.setCustomValidity('');
    }
});
</script>

{% endblock %}